--- RCPTT testcase ---
Format-Version: 1.0
Contexts: _eXb6MPp7EeW7_PzjO98BIw
Element-Name: AutoDisoverFromProjectExplorer
Element-Type: testcase
Element-Version: 3.0
External-Reference: 
Id: _5wbGUP_mEeWRL4nRKA71zA
Runtime-Version: 2.0.2.201511100828
Save-Time: 4/13/16 6:06 PM
Testcase-Type: ecl

------=_.content-0a7243a0-75d3-3d5f-9791-539de0e5b7ac
Content-Type: text/ecl
Entry-Name: .content

//open red.xml and uncheck all options for Auto Discover
get-view "Project Explorer" | get-tree | select "RobotProject/red.xml" | double-click
with [get-editor "RobotProject/red.xml"] {
    get-tab-folder | get-tab-item "Referenced libraries" | click
    with [get-section "Referenced libraries" | get-button "Auto discover libraries after test suite save action"] {
        uncheck
        key-type "M1+s"
    }
    close
}
//select Suite to disocver
get-view "Project Explorer" | get-tree | select "RobotProject/lib_with_variable.robot" 
    | get-menu "Robot Framework/Automatically discover and add libraries to red.xml" | click
    
//check windows with summary    
with [get-window "Discovering libraries summary" | get-tree] {
    get-item multiply | get-property index | equals 0 | verify-true
    get-item multiply | get-property "image.path" 
        | equals "org.robotframework.ide.eclipse.main.plugin/resources/success_big.png" | verify-true
    get-item "lib1.py" | get-property index | equals 1 | verify-true
    get-item "lib1.py" | get-property "image.path" 
        | equals "org.robotframework.ide.eclipse.main.plugin/resources/error_fatal.png" | verify-true
    get-property itemCount | equals 2 | verify-true
}
get-window "Discovering libraries summary" | get-button OK | click

//check that lib was added to red.xml
get-view "Project Explorer" | get-tree | select "RobotProject/red.xml" | double-click
with [get-editor "RobotProject/red.xml" | get-section "Referenced libraries" | get-table] {
    get-property itemCount | equals 1 | verify-true
    get-property "getItems().TableItem[0].getText()" | equals "multiply - RobotProject" | verify-true
}

//remove lib from red.xml
get-view "Project Explorer" | get-tree | select "RobotProject/red.xml" | double-click
with [get-editor "RobotProject/red.xml" | get-section "Referenced libraries" | get-table] {
    select "multiply - RobotProject" | key-type Del
    key-type "M1+s"
}
//use autodiscover on folder
get-view "Project Explorer" | get-tree | select "RobotProject/tests" 
    | get-menu "Robot Framework/Automatically discover and add libraries to red.xml" | click

try -times 4 -delay 1000 -command{
		get-window "Discovering libraries summary"
}    
//check window    
with [get-window "Discovering libraries summary" | get-tree] {
    get-property itemCount | equals 6 | verify-true
    get-property "getItems().TreeItem[0].getText()" | equals add | verify-true
    get-property "getItems().TreeItem[1].getText()" | equals divide | verify-true
    get-property "getItems().TreeItem[2].getText()" | equals "lib_with_args" | verify-true
    get-property "getItems().TreeItem[3].getText()" | equals multiply | verify-true
    get-property "getItems().TreeItem[4].getText()" | equals res1 | verify-true
    get-property "getItems().TreeItem[5].getText()" | equals "c:folderfile.py" | verify-true
}
get-window "Discovering libraries summary" | get-button OK | click

//check red.xml if all libs were added
get-view "Project Explorer" | get-tree | select "RobotProject/red.xml" | double-click
with [get-editor "RobotProject/red.xml" | get-section "Referenced libraries" | get-table] {
    get-property itemCount | equals 5 | verify-true
    get-property "getItems().TableItem[0].getText()" | equals "divide - RobotProject/libs/t" | verify-true
    get-property "getItems().TableItem[1].getText()" | equals "res1 - RobotProject/libs/for_resource" | verify-true
    get-property "getItems().TableItem[2].getText()" | equals "multiply - RobotProject" | verify-true
    get-property "getItems().TableItem[3].getText()" | equals "add - RobotProject/libs" | verify-true
    get-property "getItems().TableItem[4].getText()" | equals "lib_with_args - RobotProject/libs" | verify-true
}

//use autodiscver on .py
get-view "Project Explorer" | get-tree | select "RobotProject/libs/add.py"
exec-with-options {
    get-view "Project Explorer" | get-tree 
        | get-menu "Robot Framework/Automatically discover and add libraries to red.xml" | click
	verify-error{get-window "Problem Occurred"}
} -allowStatusDialog

wait 3000
with [get-window "Discovering libraries summary"] {
    get-label "Discovered libraries (0):" | get-property caption | equals "Discovered libraries (0):" | verify-true
    get-tree | get-property itemCount | equals 0 | verify-true
}
get-window "Discovering libraries summary" | get-button OK | click


//autodiscover on suite with no libs
get-view "Project Explorer" | get-tree | select "RobotProject/libs/add.py" 
    | get-menu "Robot Framework/Automatically discover and add libraries to red.xml" | click
wait 3000
    
with [get-window "Discovering libraries summary"] {
    get-label "Discovered libraries (0):" | get-property caption | equals "Discovered libraries (0):" | verify-true
    get-tree | get-property itemCount | equals 0 | verify-true
}
get-window "Discovering libraries summary" | get-button OK | click


------=_.content-0a7243a0-75d3-3d5f-9791-539de0e5b7ac--
