--- RCPTT testcase ---
Format-Version: 1.0
Contexts: _eXb6MPp7EeW7_PzjO98BIw
Element-Name: AddingValuseToPYTHONPATH
Element-Type: testcase
Element-Version: 3.0
External-Reference: 
Id: _xmkpUP_xEeWRL4nRKA71zA
Runtime-Version: 2.0.2.201511100828
Save-Time: 4/20/16 4:00 PM
Testcase-Type: ecl

------=_.content-0a7243a0-75d3-3d5f-9791-539de0e5b7ac
Content-Type: text/ecl
Entry-Name: .content

//remove autodiscover
get-view "Project Explorer" | get-tree | select "RobotProject/red.xml" | double-click
with [get-editor "RobotProject/red.xml"] {
    get-tab-folder | get-tab-item "Referenced libraries" | click
    with [get-section "Referenced libraries" | get-button "Auto discover libraries after test suite save action"] {
        uncheck
        key-type "M1+s"
    }
}

//add Library "add" to Suite
get-view "Project Explorer" | get-tree | select "RobotProject/lib_with_variable.robot" | double-click
with [get-editor "lib_with_variable.robot" | get-text-viewer] {
    set-caret-pos 3 20
    select-range 4 19 2 11
    type-text add
    key-type "M1+s"
}

//run test
get-view "Project Explorer" | get-tree | select "RobotProject/lib_with_variable.robot" 
    | select "RobotProject/lib_with_variable.robot" | get-menu "Run As/1 Robot Test" | click
    
//check error on console    
get-view Console | get-text-viewer | get-property text 
    | contains " Importing test library 'add' failed: ImportError: No module named add\n" | verify-true
get-tab-folder -index 1 | get-tab-item "RobotProject/red.xml" | click

//add path to lib to red.xml
get-editor "RobotProject/red.xml" | get-section Paths | get-table | get-item "...add new search path" |double-click
with [get-window "Add new search path"] {
    get-editbox -after [get-label "Provide search paths to be added. Each path should be specified in separate line."] 
        | set-text [format "%s/RobotProject/libs" $RED_workspace_path]
    get-button OK | click
 
}
get-button "Save \((Ctrl|M1)\+S\)" | click
//run test
get-tab-folder -index 1 | get-tab-item "lib_with_variable.robot" | click
get-view "Project Explorer" | get-tree | select "RobotProject/lib_with_variable.robot" 
    | select "RobotProject/lib_with_variable.robot" | get-menu "Run As/1 Robot Test" | click

//check that error is not shown
get-view Console | get-text-viewer | get-property text 
    | contains " Importing test library 'add' failed: ImportError: No module named add\n" | verify-false
get-tab-folder -index 1 | get-tab-item "RobotProject/red.xml" | click


//add diffrent path ("a" is double)
get-editor "RobotProject/red.xml" | get-section Paths | get-table | select  [get-item "...add new search path" ]
get-editor "RobotProject/red.xml" | get-section Paths | get-table | get-item "...add new search path" | double-click
with [get-window "Add new search path"] {
    with [get-editbox 
        -after [get-label "Provide search paths to be added. Each path should be specified in separate line."]] {
        set-text "not existing\n"
            + "C:\\folder\\folder2\n"
            + "/!@#$%path/new.file.txt\n"
            + "\"escpaed\\\\text\"\n\n"
            + "correct\ttab\t/folder\n"
            + "a\n"
            + "b\n"
            + "a"
    }
    get-button OK | click
}

get-button "Save \((Ctrl|M1)\+S\)" | click

//run test and check that pythonpath args were added do robot
get-tab-folder -index 1 | get-tab-item "lib_with_variable.robot" | click
get-view "Project Explorer" | get-tree | select "RobotProject/lib_with_variable.robot" | get-menu "Run As/1 Robot Test" 
    | click
    
//check first line to see pythonapth (extarcted due to long syntax) 
if [get-by-os -linux "Linux" -win "Windows"| equals "Windows"]{   
	replace -input $RED_workspace_path -old "\\" -new "\\\\" | let[val new_ws_path -input]{    
		let [val rp 
		   [format "(%s\\\\b|%s\\\\\"escpaed\\\\text\"|%s\\\\correct tab \\\\folder|%s\\\\a|\\\\!@#\$%%path\\\\new.file.txt|C:\\\\folder\\\\folder2|%s\\\\RobotProject\\\\libs|%s\\\\not existing)" $new_ws_path $new_ws_path $new_ws_path $new_ws_path $new_ws_path $new_ws_path]]
		   {
				get-view Console | get-text-viewer | get-object |invoke getLine  0
				| matches [format "Command: .* -m .* -P %s:%s:%s:%s:%s:%s:%s.* --listener .*" $rp $rp $rp $rp $rp $rp $rp] 
				| verify-true
		}
	
	}
}-else{
	let [val rp 
	   [format "(%s/b|%s/\"escpaed/text\"|%s/correct tab /folder|%s/a|\!@#\$%%path/new.file.txt|C:\\\\folder\\\\folder2|%s/RobotProject/libs|%s/not existing)" $new_ws_path $new_ws_path $new_ws_path $new_ws_path $new_ws_path $new_ws_path]]
	   {
			get-view Console | get-text-viewer | get-object |invoke getLine  0
			| matches [format "Command: .* -m .* -P %s:%s:%s:%s:%s:%s:%s.* --listener .*" $rp $rp $rp $rp $rp $rp $rp] 
			| verify-true
	}

}
//check console
get-view Console | get-text-viewer | get-property text 
	    | equals "Command:.* -m .* -P .* --listener.*\n"  
	    + "Suite Executor: Robot Framework .*\n"
	    + "==============================================================================\n"
	    + "RobotProject                                                                  \n"
	    + "==============================================================================\n"
	    + "RobotProject.Lib With Variable                                                \n"
	    + "==============================================================================\n"
	    + "test                                                                  \| PASS \|\n"
	    + "------------------------------------------------------------------------------\n"
	    + "RobotProject.Lib With Variable                                        \| PASS \|\n"
	    + "1 critical test, 1 passed, 0 failed\n"
	    + "1 test total, 1 passed, 0 failed\n"
	    + "==============================================================================\n"
	    + "RobotProject                                                          \| PASS \|\n"
	    + "1 critical test, 1 passed, 0 failed\n"
	    + "1 test total, 1 passed, 0 failed\n"
	    + "==============================================================================\n"
	    + "Output:  .*output.xml\n"
	    + "Log:     .*log.html\n"
	    + "Report:  .*report.html"| verify-true
	    

//add more items to path    
get-tab-folder -index 1 | get-tab-item "RobotProject/red.xml" | click
get-editor "RobotProject/red.xml" | get-section Paths | get-table | select  [get-item "...add new search path" ]
get-editor "RobotProject/red.xml" | get-section Paths | get-table | get-item "...add new search path" | double-click
with [get-window "Add new search path"] {
    with [get-editbox 
        -after [get-label "Provide search paths to be added. Each path should be specified in separate line."]] {
        set-text "scrolbar\na\nb\nc\n"
            + "d"
    }
    get-button OK | click
}

//check that scrollbbar is shown
get-editor "RobotProject/red.xml" | get-section Paths | get-table | get-property "getVerticalBar().isEnabled()" 
    | equals true | verify-true
    
//check if new items were added (b is duplicated)    
get-editor "RobotProject/red.xml" | get-section Paths | get-table | get-property itemCount -raw | int | minus 12| let [val nr_of_paths -input]{
	
	with [get-editor "RobotProject/red.xml" | get-section Paths | get-table] {
	    get-property [format "getItems().TableItem[%s].getText()" [plus 0 $nr_of_paths]] | equals [format "%s/RobotProject/libs" $RED_workspace_path] | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 1 $nr_of_paths]] | equals "not existing" | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 2 $nr_of_paths]] | equals "C:\\folder\\folder2" | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 3 $nr_of_paths]] | equals "/!@#$%path/new.file.txt" | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 4 $nr_of_paths]]| equals "\"escpaed\\\\text\"" | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 5 $nr_of_paths]] | equals "correct\\9tab\\9/folder" | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 6 $nr_of_paths]] | equals a | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 7 $nr_of_paths]] | equals b | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 8 $nr_of_paths]] | equals scrolbar | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 9 $nr_of_paths]] | equals c | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 10 $nr_of_paths]] | equals d | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 11 $nr_of_paths]]| equals "...add new search path" | verify-true
	}
}
with [get-editor "RobotProject/red.xml" | get-section Paths | get-table] {
	//select 2 item next to each other and one not
    select "\\/!@#$%path\\/new.file.txt" "\"escpaed\\\\text\"" "d"
    key-type Del
    
    //select one
    select scrolbar | key-type Del
}
get-editor "RobotProject/red.xml" | get-section Paths | get-table | get-property itemCount -raw | int | minus  8 | let [val nr_of_paths -input]{
	with [get-editor "RobotProject/red.xml" | get-section Paths | get-table] {
	    get-property [format "getItems().TableItem[%s].getText()" [plus 0 $nr_of_paths]] | equals [format "%s/RobotProject/libs" $RED_workspace_path] | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 1 $nr_of_paths]]| equals "not existing" | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 2 $nr_of_paths]] | equals "C:\\folder\\folder2" | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 3 $nr_of_paths]] | equals "correct\\9tab\\9/folder" | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 4 $nr_of_paths]] | equals a | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 5 $nr_of_paths]] | equals b | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 6 $nr_of_paths]] | equals c | verify-true
	    get-property [format "getItems().TableItem[%s].getText()" [plus 7 $nr_of_paths]]| equals "...add new search path" | verify-true
	}
}	
	
------=_.content-0a7243a0-75d3-3d5f-9791-539de0e5b7ac--
