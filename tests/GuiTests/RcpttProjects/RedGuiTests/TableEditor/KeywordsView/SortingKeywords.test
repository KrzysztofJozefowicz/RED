--- RCPTT testcase ---
Format-Version: 1.0
Contexts: _7-QNADzcEeWxlsQvwWxD9w
Element-Name: SortingKeywords
Element-Type: testcase
Element-Version: 3.0
External-Reference: 
Id: _1s4yIED5EeW20a8v9jefTQ
Runtime-Version: 2.0.0.201506120617
Save-Time: 8/17/15 2:13 PM
Testcase-Type: ecl

------=_.content-0a7243a0-75d3-3d5f-9791-539de0e5b7ac
Content-Type: text/ecl
Entry-Name: .content


proc "check-outline-and-project-expolrer" [val added_keyword ""] {
	get-view Outline | get-tree | select "TestFile.robot/Keywords/.*"
	if [$added_keyword | eq ""]{
		with [get-view Outline | get-tree] {
		    get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItemCount()" | equals 6| verify-true
		    get-property "getItems().TreeItem[0].getText()" | equals "TestFile.robot" | verify-true
		    get-property "getItems().TreeItem[0].getItems().TreeItem[0].getText()" | equals Keywords | verify-true
		    get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[0].getText()" | equals Keyword 
		        | verify-true
		    get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[0].getExpanded()" | equals false 
		        | verify-true
		    get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[1].getText()" | equals A 
		        | verify-true
		    get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[1].getExpanded()" | equals false 
		        | verify-true
		    get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[2].getText()" | equals "new kw" 
		        | verify-true
		    get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[2].getExpanded()" | equals false 
		        | verify-true
		    get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[3].getText()" | equals "_last_" 
		        | verify-true
		    get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[3].getExpanded()" | equals false 
		        | verify-true
		    get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[4].getText()" | equals "1 keyword" 
		        | verify-true
		    get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[4].getExpanded()" | equals false 
		        | verify-true
	    	get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[5].getText()" 
	    	| equals "space here" | verify-true
	    	get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[5].getExpanded()" | equals false 
	    	
		}
	}-else{
		get-view Outline | get-tree 
    	| get-property "getItems().TreeItem[0].getItems().TreeItem[0].getItems().TreeItem[6].getText()" 
    	| equals "Keyword 1" | verify-true
	}
	   

	//check project explorer  
	get-view "Project Explorer" | get-tree | select "RobotProject/TestFile.robot/Keywords/.*"
	if [$added_keyword | eq ""]{
		with [get-view "Project Explorer" | get-tree] {
		    get-item "RobotProject/TestFile.robot" | get-property "getItems().TreeItem[0].getItems().TreeItem[0].getText()" 
		        | equals Keyword | verify-true
		    get-item "RobotProject/TestFile.robot" | get-property "getItems().TreeItem[0].getItems().TreeItem[1].getText()" 
		        | equals A | verify-true
		    get-item "RobotProject/TestFile.robot" | get-property "getItems().TreeItem[0].getItems().TreeItem[2].getText()" 
		        | equals "new kw" | verify-true
		    get-item "RobotProject/TestFile.robot" | get-property "getItems().TreeItem[0].getItems().TreeItem[3].getText()" 
		        | equals "_last_" | verify-true
		    get-item "RobotProject/TestFile.robot" | get-property "getItems().TreeItem[0].getItems().TreeItem[4].getText()" 
		        | equals "1 keyword" | verify-true
		    get-item "RobotProject/TestFile.robot" | get-property "getItems().TreeItem[0].getText()" | equals Keywords 
		        | verify-true
		    get-item "RobotProject/TestFile.robot" | get-property "getText()" | equals "TestFile.robot" | verify-true
		    get-item "RobotProject/TestFile.robot/Keywords" | get-property childCount | equals 6 | verify-true
			get-view "Project Explorer" | get-tree | get-item "RobotProject/TestFile.robot" 
		    | get-property "getItems().TreeItem[0].getItems().TreeItem[5].getText()" | equals "space here" | verify-true
		}
	}-else{
		get-view "Project Explorer" | get-tree | get-item "RobotProject/TestFile.robot" 
	    	| get-property "getItems().TreeItem[0].getItems().TreeItem[6].getText()" | equals "Keyword 1" | verify-true
	}
}

get-view "Project Explorer" | get-tree | select "RobotProject/TestFile.robot" | select "RobotProject/TestFile.robot" 
    | double-click
with [get-editor "TestFile.robot"] {
    get-tab-folder | get-tab-item Keywords | click
    get-link "Section is not yet defined, do you want to create it?" | click
}

//add keywords
add-keyword-with-elements-by-double-click -keyword_name "Keyword" -elements [list "new line" "1" "2" "3" "4" "5" "comment"] -script_name "TestFile.robot"
add-row-to-keyword-by-double-click-on-cell -keyword_name "Keyword" -keyword_index 0 -elements [list "Z line" "6" "7" "8" "9" "10" "comment 2"] -command_index 0 -script_name "TestFile.robot"
add-row-to-keyword-by-double-click-on-cell -keyword_name "Keyword" -keyword_index 0 -elements [list "a line"] -command_index 0-script_name "TestFile.robot"

add-keyword-by-double-click -keywords_list [list "A"] -script_name "TestFile.robot"
add-keyword-with-elements-by-double-click -keyword_name "new kw"  -elements [list "_text_" "Abba"] -script_name "TestFile.robot"

add-row-to-keyword-by-double-click-on-cell -keyword_name "new kw"  -keyword_index 0 -elements [list "abc" "Zombie"] -command_index 0 -script_name "TestFile.robot"
add-row-to-keyword-by-double-click-on-cell -keyword_name "new kw" -keyword_index 0 -elements [list "1" "11"] -command_index 0 -script_name "TestFile.robot"
add-row-to-keyword-by-double-click-on-cell -keyword_name "new kw" -keyword_index 0 -elements [list "${var}" "" "variable"] -command_index 0 -script_name "TestFile.robot"

//collapse - to add more keywords
get-editor "TestFile.robot" | get-tree | select "new kw"  | get-menu "Table/Collapse All" | click

add-keyword-with-elements-by-double-click -keyword_name "_last_" -elements [list "show"] -script_name "TestFile.robot"
add-row-to-keyword-by-double-click-on-cell -keyword_name "_last_" -keyword_index 0 -elements [list "@{show1}"] -command_index 0 -script_name "TestFile.robot"

add-keyword-with-args-by-double-click  -keyword_name "1 keyword"  -keyword_index 0 -arguments [list "${a}"]  -keyword_index 0 -script_name "TestFile.robot"
add-row-to-keyword-by-double-click-on-cell -keyword_name "1 keyword"  -keyword_index 0  -elements [list ""] -command_index 0 -script_name "TestFile.robot"
add-keyword-with-elements-by-double-click -keyword_name " space here " -elements [list "empty keyword"] -script_name "TestFile.robot"



//get-editor "TestFile.robot" | get-tree | get-table-data |  write-csv-file "file:/c:/aaa/file.csv"  

//expand all to do verification
get-editor "TestFile.robot" | get-tree | select A | select A | get-menu "Table/Expand All" | click

//check not sorted
get-editor "TestFile.robot" | get-tree | get-table-data | eq [read-csv-file [uri-from-path  [format "%s/TableEditor/KeywordsView/Verification/KeywordsNotSorted.csv" $RCPTT_project_path] ] ]|
		 assert-true -message "Data in table does not match input file"
	
check-outline-and-project-expolrer 

//sort (asc)
get-editor "TestFile.robot" | get-tree | get-column-header "" | click
get-editor "TestFile.robot" | get-control Any -after [get-label "User Keywords"] -index 4 
    | get-property "getTabList().Control[0].getSortDirection()" | equals 128 | verify-true

get-editor "TestFile.robot" | get-tree | get-table-data | eq [read-csv-file [uri-from-path  [format "%s/TableEditor/KeywordsView/Verification/KeywordsSortedAsc.csv" $RCPTT_project_path] ] ]|
		 assert-true -message "Data in table does not match input file"
check-outline-and-project-expolrer 

//sort desc		 
get-editor "TestFile.robot" | get-tree | get-column-header "" | click
get-editor "TestFile.robot" | get-control Any -after [get-label "User Keywords"] -index 4 
    | get-property "getTabList().Control[0].getSortDirection()" | equals 1024 | verify-true		
    
    
get-editor "TestFile.robot" | get-tree | get-table-data | eq [read-csv-file [uri-from-path  [format "%s/TableEditor/KeywordsView/Verification/KeywordSortedDesc.csv" $RCPTT_project_path] ] ]|
		 assert-true -message "Data in table does not match input file"    

check-outline-and-project-expolrer 

//sort - reset to default	
get-editor "TestFile.robot" | get-tree | get-column-header "" | click
get-editor "TestFile.robot" | get-control Any -after [get-label "User Keywords"] -index 4 
    | get-property "getTabList().Control[0].getSortDirection()" | equals 0 | verify-true			 
     
get-editor "TestFile.robot" | get-tree | get-table-data | eq [read-csv-file [uri-from-path  [format "%s/TableEditor/KeywordsView/Verification/KeywordsNotSorted.csv" $RCPTT_project_path] ] ]|
		 assert-true -message "Data in table does not match input file"   
		 
check-outline-and-project-expolrer 

//sort ascending
get-editor "TestFile.robot" | get-tree | get-column-header "" | click

//save file - should be not sorted
get-editor "TestFile.robot" | get-tree | select Keyword
get-menu "File/Save" | click
get-editor "TestFile.robot" | close
get-view "Project Explorer" | get-tree | select "RobotProject/TestFile.robot" | select "RobotProject/TestFile.robot" 
    | double-click

//open source    
with [get-editor "TestFile.robot"] {
    with [get-tab-folder] {
        get-tab-item Source | click
	}
}
get-editor "TestFile.robot" | get-text-viewer | get-property text | equals "*** Keywords ***\n"
    + "Keyword\n"
    + "    new line    1    2    3    4    5    # comment\n"
    + "    Z line    6    7    8    9    10    # comment 2\n"
    + "    a line\n\nA\n\n"
    + "new kw\n"
    + "    _text_    Abba\n"
    + "    abc    Zombie\n"
    + "    1    11\n"
    + "    ${var}        variable\n\n"
    + "_last_\n"
    + "    show\n"
    + "    @{show1}\n\n"
    + "1 keyword\n"
    + "    [Arguments]    ${a}\n"
    + "    \n\n"
    + " space here \n"
    + "    empty keyword" | verify-true
    
//add new keyword    
with [get-editor "TestFile.robot"] {
    with [get-tab-folder] {
        get-tab-item Keywords | click      
    }
    with [get-tree] {
    	select "...add new keyword" 
        get-item "...add new keyword" | double-click
        select "Keyword 1" | activate-cell-edit
        get-editbox | key-type Enter
        apply-cell-edit -deactivate
        get-item "Keyword 1/..."  | double-click
        select "Keyword 1/" | activate-cell-edit
        with [get-editbox] {
            set-text Log
            key-type Enter
        }
        apply-cell-edit -deactivate
        select "Keyword 1/Log" | select "Keyword 1/Log" | double-click
        select "Keyword 1/Log" | activate-cell-edit -column 1
        with [get-editbox] {
            set-text text
            key-type Enter
        }
        apply-cell-edit -deactivate
        //sort ascending
        get-column-header "" | click
    }
}

//save file
get-menu "File/Save" | click

//check after sorting (should be not sorted)
check-outline-and-project-expolrer -added_keyword "keyword 1"


------=_.content-0a7243a0-75d3-3d5f-9791-539de0e5b7ac--
